-- PostgreSQL DBA - Basic Health Check (SQL)
-- Run as a superuser or monitoring role

-- PostgreSQL version
SELECT version();

-- Database uptime
SELECT now() - pg_postmaster_start_time() AS uptime;

-- Connections overview
SELECT
  count(*) AS total_connections,
  sum(CASE WHEN state = 'active' THEN 1 ELSE 0 END) AS active_connections
FROM pg_stat_activity;

-- Long-running queries (> 5 minutes)
SELECT pid, usename, state, now() - query_start AS runtime, query
FROM pg_stat_activity
WHERE state = 'active'
  AND now() - query_start > interval '5 minutes';

-- Replication status (if any)
SELECT * FROM pg_stat_replication;

-- Checkpoints & background writer stats
SELECT * FROM pg_stat_bgwriter;
