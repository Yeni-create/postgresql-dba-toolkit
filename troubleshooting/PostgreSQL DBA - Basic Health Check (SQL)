#!/bin/bash
#
# PostgreSQL DBA - Basic Health Check (Bash)
# Platform: RHEL / Rocky / Alma
#

PG_PORT=5432
PG_USER=postgres

echo "=============================="
echo " PostgreSQL DBA Health Check"
echo "=============================="

echo
echo "1) PostgreSQL service status"
systemctl status postgresql-17 --no-pager

echo
echo "2) PostgreSQL port check ($PG_PORT)"
ss -lntp | grep $PG_PORT || echo "PostgreSQL is NOT listening on port $PG_PORT"

echo
echo "3) PostgreSQL processes"
ps -ef | grep '[p]ostgres'

echo
echo "4) Disk usage (important for PGDATA)"
df -h /var/lib/pgsql

echo
echo "5) Memory usage"
free -h

echo
echo "6) Recent PostgreSQL logs (last 10 lines)"
journalctl -u postgresql-17 -n 10 --no-pager

echo
echo "=============================="
echo " Health check completed"
echo "=============================="
